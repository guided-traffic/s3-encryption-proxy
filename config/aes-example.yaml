---
# Server configuration
bind_address: "0.0.0.0:8080"

log_level: "info"
log_format: "text"   # "text" (default) or "json" - controls log output format

log_health_requests: false  # Disable health endpoint logging by default

# S3 backend configuration (unified structure)
s3_backend:
  target_endpoint: "https://minio:9000"
  region: "us-east-1"
  access_key_id: "minioadmin"
  secret_key: "minioadmin123"
  use_tls: true
  insecure_skip_verify: true

# S3 Client Authentication Configuration (Enterprise Security)
# This enables strict authentication for all S3 API calls
s3_clients:
  # Production application client
  - type: "static"
    access_key_id: "username0"
    secret_key: "this-is-not-very-secure" # minimum 16 characters
    description: "the user0 has same accessright like s3_backend-credentials"

  # Backend service client
  - type: "static"
    access_key_id: "username1"
    secret_key: "this-is-even-worse" # minimum 16 characters
    description: "the user1 has same accessright like s3_backend-credentials"

# S3 Security Configuration (Cybersecurity Features)
s3_security:
  # Enable strict AWS Signature V4 validation (recommended: true)
  strict_signature_validation: true

  # Maximum allowed clock skew in seconds (default: 900 = 15 minutes)
  # Shorter values provide better security against replay attacks
  max_clock_skew_seconds: 300  # 5 minutes for high security

  # Enable rate limiting per client IP (recommended: true)
  enable_rate_limiting: true

  # Maximum requests per minute per IP (adjust based on load)
  max_requests_per_minute: 60  # Conservative limit

  # Enable comprehensive security logging (recommended: true)
  enable_security_logging: true

  # Block IPs after this many failed authentication attempts
  max_failed_attempts: 5  # Strict security - block after 5 failures

  # Automatically unblock IPs after this many seconds (default: 60)
  # 0 = never unblock automatically (manual intervention required)
  unblock_ip_seconds: 60  # Unblock after 1 minute

monitoring:
  enabled: true
  bind_address: ":9090"
  metrics_path: "/metrics"

# Specify custom path to license file
# If not specified, defaults to "config/license.jwt"
license_file: "config/license.jwt"

# Multi-Provider Encryption Configuration
encryption:
  # Active encryption method (used for writing new files) - CORRECTED ARCHITECTURE!
  encryption_method_alias: "aes-envelope"

  # Integrity Verification Configuration with Extended HMAC Modes
  # Controls how HMAC integrity verification is handled for encrypted data
  #
  # Available modes:
  # - "off"    : No HMAC verification. No HMACs are calculated, written, or processed.
  #              This saves CPU resources but provides no integrity checking.
  #
  # - "lax"    : Normal HMAC creation on upload and verification on download.
  #              If HMAC verification fails, an error is logged but the file is
  #              delivered normally. Good for monitoring data integrity issues
  #              without breaking functionality.
  #
  # - "strict" : Normal HMAC creation on upload and verification on download.
  #              If HMAC verification fails, the download is aborted and an error
  #              is returned. This provides maximum data integrity protection.
  #
  # - "hybrid" : Like strict mode, but if a file has no HMAC metadata (e.g.,
  #              legacy files), this is ignored and the file is delivered.
  #              On upload, HMAC is always added. Good for migration scenarios.
  #
  # Default: "off" (for backward compatibility)
  integrity_verification: "lax"

  # Custom metadata prefix - this will be used instead of default "s3ep-"
  # All encryption metadata keys will use this prefix
  # metadata_key_prefix: "mycompany-enc-"

  # List of KEK providers (correct architecture)
  providers:
    - alias: "aes-envelope"
      type: "aes"
      description: "AES envelope encryption (auto-selects AES-CTR for multipart, AES-GCM for whole files)"
      config:
        # A demo key (do NOT use in production!)
        aes_key: "XZmcGLpObUuGV8CFOmfLKs7rggrX2TwIk5/Lbt9Azl4="

# Performance Optimizations Configuration
optimizations:
  # Streaming buffer size for chunk-wise processing (4KB - 2MB)
  # Default: 64KB (65536 bytes)
  # Higher values: Better throughput for large files, more memory usage
  # Lower values: Better for memory-constrained environments, more CPU overhead
  streaming_buffer_size: 65536  # 64KB

  # Streaming segment size for multipart uploads (5MB - 5GB)
  # Default: 12MB (12582912 bytes)
  # This defines how much data is collected before sending as one S3 upload part
  streaming_segment_size: 12582912  # 12MB = 12 * 1024 * 1024 bytes

  # Enable adaptive buffering based on system load (experimental)
  # When enabled, buffer sizes adjust dynamically
  enable_adaptive_buffering: false

  # Processing strategy threshold
  # Files larger than streaming_threshold use streaming uploads (AES-CTR for multipart)
  # Files smaller than streaming_threshold use direct encryption (AES-GCM for whole files)
  streaming_threshold: 5242880  # 5MB
